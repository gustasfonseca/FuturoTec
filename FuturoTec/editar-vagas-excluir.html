<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gestão de Vagas - Assistente Técnico</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<style>
* { margin:0; padding:0; box-sizing:border-box; font-family:'Poppins', sans-serif; }
body { background-color:#f8f9fa; color:#343a40; line-height:1.6; }
.header { background-color:#fff; box-shadow:0 2px 5px rgba(0,0,0,0.1); padding:1rem 0; }
.nav-wrapper { max-width:1200px; margin:0 auto; display:flex; justify-content:space-between; align-items:center; }
.logo img { height:50px; }
.nav-desktop { display:flex; gap:1.5rem; }
.nav-link { font-weight:500; color:#343a40; padding:0.5rem 1rem; border-radius:6px; transition:all 0.3s ease; }
.nav-link:hover, .nav-link.active { background-color:#008080; color:#fff; }
.nav-actions .login-btn { display:inline-flex; align-items:center; gap:0.5rem; background-color:#008080; color:#fff; border:none; padding:0.5rem 1rem; border-radius:6px; font-weight:500; transition:background-color 0.3s ease; }
.nav-actions .login-btn:hover { background-color:#006666; }
.main-content { max-width:1200px; margin:2rem auto; padding:0 20px; }
.page-header h1 { font-size:2rem; margin-bottom:0.5rem; }
.page-header p { color:#6c757d; }
.table-card { background-color:#fff; padding:1.5rem; border-radius:8px; box-shadow:0 4px 6px rgba(0,0,0,0.05); margin-top:2rem; }
.table-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem; }
table { width:100%; border-collapse:collapse; }
th, td { text-align:left; padding:0.8rem; border-bottom:1px solid #e9ecef; }
th { font-weight:600; color:#6c757d; text-transform:uppercase; font-size:0.9rem; }
tr:hover { background-color:#f1f3f5; }
.action-buttons button { border:none; background:none; font-size:1.2rem; margin-right:0.8rem; color:#343a40; transition:transform 0.2s ease; }
.action-buttons button:hover { transform:scale(1.2); color:#008080; }
/* Footer simples */
.footer { background-color:#008080; color:#fff; text-align:center; padding:1.5rem 0; font-size:0.95rem; font-weight:400; margin-top:3rem; box-shadow:0 -2px 5px rgba(0,0,0,0.1); }
.modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); justify-content:center; align-items:center; z-index:1000; }
.modal-content { background:#fff; padding:20px; border-radius:8px; width:90%; max-width:400px; display:flex; flex-direction:column; gap:10px; }
.modal-content input { padding:8px; border-radius:6px; border:1px solid #ccc; }
.modal-content button { padding:10px; border:none; border-radius:6px; background:#008080; color:#fff; font-weight:500; cursor:pointer; }
.modal-content button:hover { background:#006666; }
.modal-content .cancel-btn { background:#ccc; color:#000; }
@media(max-width:768px){ .nav-desktop { flex-direction:column; gap:0.5rem; } }
</style>
</head>
<body>

<header class="header">
  <div class="container">
    <div class="nav-wrapper">
      <div class="logo">
        <img src="img/FuturoTecInicial.jpeg" alt="FuturoTEC Logo">
      </div>
      <nav class="nav-desktop student-nav">
        <a href="InicialAssistente.html" class="nav-link">Início</a>
      </nav>
      <div class="nav-actions">
        <a href="PerfilAssistente.html" class="login-btn"><i class="fa-solid fa-user"></i> Meu Perfil</a>
      </div>
    </div>
  </div>
</header>

<main class="main-content">
  <div class="page-header">
    <h1>Gestão de Vagas</h1>
    <p>Veja, edite ou exclua as vagas publicadas.</p>
  </div>

  <div class="table-card">
    <div class="table-header">
      <h3>Vagas Publicadas</h3>
      <!-- Botão de adicionar removido -->
    </div>
    <table id="jobsTable">
      <thead>
        <tr>
          <th>Título</th>
          <th>Empresa</th>
          <th>Local</th>
          <th>Contato</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</main>

<footer class="footer">
    <div class="container footer-grid">
        <div class="footer-info">
            <h4>FuturoTEC</h4>
            <p>Projeto de Conclusão de Curso (TCC)</p>
            <p class="school">ETEC Albert Einstein</p>
            <p class="copyright">© 2025 FuturoTEC. Todos os direitos reservados.</p>
            <p class="authors">Desenvolvido por: Nátaly Lima, Gustavo Fonseca, Eduarda Marques, Amanda Silva, Gabrielly Mendes, Uillian Oliveira e Felipe Cardoso.</p>
        </div>

        <div class="footer-links">
            <h4>Links Úteis</h4>
            <ul>
                <li>Termos de Uso</li>
                <li>Política de Privacidade</li>
                <li>Sobre nós</li>
                <li>Contato</li>
            </ul>
        </div>

        <div class="footer-social">
            <h4>Conecte-se</h4>
            <div class="social-icons">
                <span>[Facebook]</span>
                <span>[LinkedIn]</span>
                <span>[Twitter]</span>
            </div>
        </div>
    </div>
</footer>

<style>
.footer a { 
    color: inherit; 
    text-decoration: none; 
    cursor: default; 
}
.footer ul li {
    list-style: none;
    margin-bottom: 5px;
}
.social-icons span {
    margin-right: 10px;
    color: #fff;
}
</style>

<div class="modal" id="modal">
  <div class="modal-content">
    <input type="text" id="cargoInput" placeholder="Título da Vaga">
    <input type="text" id="empresaInput" placeholder="Empresa">
    <input type="text" id="localInput" placeholder="Local">
    <input type="text" id="contatoInput" placeholder="Contato">
    <button type="button" id="saveBtn">Salvar</button>
    <button type="button" id="cancelBtn" class="cancel-btn">Cancelar</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
import { getFirestore, collection, getDocs, updateDoc, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js";

// Configuração do Firebase
const firebaseConfig = {
  apiKey: "AIzaSyA8Q9cKB4oVmFM6ilHK_70h8JDvgsOQhLY",
  authDomain: "futurotec-e3a69.firebaseapp.com",
  projectId: "futurotec-e3a69",
  storageBucket: "futurotec-e3a69.appspot.com",
  messagingSenderId: "234233783827",
  appId: "1:234233783827:web:bf9376dee78d8924ef01e6"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const vagasRef = collection(db, "vagas");

// Elementos do DOM
const table = document.querySelector("#jobsTable tbody");
const modal = document.getElementById("modal");
const cargoInput = document.getElementById("cargoInput");
const empresaInput = document.getElementById("empresaInput");
const localInput = document.getElementById("localInput");
const contatoInput = document.getElementById("contatoInput");
const saveBtn = document.getElementById("saveBtn");
const cancelBtn = document.getElementById("cancelBtn");

let editId = null;

// Função para carregar vagas
async function carregarVagas() {
  try {
    table.innerHTML = "";
    const snapshot = await getDocs(vagasRef);
    snapshot.forEach(docSnap => {
      const vaga = docSnap.data();
      const row = document.createElement("tr");
      row.dataset.id = docSnap.id;
      row.innerHTML = `
        <td>${vaga.titulo || ''}</td>
        <td>${vaga.empresa || ''}</td>
        <td>${vaga.local || ''}</td>
        <td>${vaga.contato || ''}</td>
        <td class="action-buttons">
          <button class="edit-btn" title="Editar"><i class="fa-solid fa-pencil"></i></button>
          <button class="delete-btn" title="Excluir"><i class="fa-solid fa-trash-can"></i></button>
        </td>
      `;
      table.appendChild(row);
    });
  } catch (error) {
    console.error("Erro ao carregar vagas:", error);
    alert("Erro ao carregar vagas. Veja o console.");
  }
}

// Fechar modal
cancelBtn.addEventListener("click", () => modal.style.display = "none");
modal.addEventListener("click", e => { if(e.target === modal) modal.style.display = "none"; });

// Editar e excluir vagas
table.addEventListener("click", async e => {
  const btn = e.target.closest(".edit-btn, .delete-btn");
  if(!btn) return;
  const row = btn.closest("tr");
  const id = row.dataset.id;

  if(btn.classList.contains("edit-btn")){
    cargoInput.value = row.children[0].textContent;
    empresaInput.value = row.children[1].textContent;
    localInput.value = row.children[2].textContent;
    contatoInput.value = row.children[3].textContent;
    editId = id;
    modal.style.display = "flex";
  }

  if(btn.classList.contains("delete-btn")){
    if(confirm("Deseja realmente excluir esta vaga?")){
      try{ 
        await deleteDoc(doc(db,"vagas",id)); 
        carregarVagas(); 
      }
      catch(e){ 
        console.error(e); 
        alert("Erro ao excluir vaga."); 
      }
    }
  }
});

// Salvar alterações (edição)
saveBtn.addEventListener("click", async () => {
  if (!editId) return; // Não permite salvar sem selecionar uma vaga

  const titulo = cargoInput.value.trim();
  const empresa = empresaInput.value.trim();
  const local = localInput.value.trim();
  const contato = contatoInput.value.trim();

  if (!titulo || !empresa || !local || !contato) {
    alert("Preencha todos os campos!");
    return;
  }

  try {
    const vagaDoc = doc(db, "vagas", editId);
    await updateDoc(vagaDoc, { titulo, empresa, local, contato });

    modal.style.display = "none";
    cargoInput.value = "";
    empresaInput.value = "";
    localInput.value = "";
    contatoInput.value = "";
    editId = null;

    carregarVagas();
  } catch (error) {
    console.error("Erro ao salvar vaga:", error);
    alert("Erro ao salvar vaga. Veja o console.");
  }
});

// Inicializa tabela
carregarVagas();
</script>

</body>
</html>
