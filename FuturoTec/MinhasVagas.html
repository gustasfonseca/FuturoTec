<!DOCTYPE html>

<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minhas Vagas | FuturoTEC</title>
    <link rel="stylesheet" href="css/styles.css" />
    <link rel="stylesheet" href="css/empresa.css" />
    <link rel="stylesheet" href="css/minhas-vagas.css" />
    
    
    <script src="https://unpkg.com/feather-icons"></script>
    </head>

<body>
    <div class="app">
        <header class="header">
            <div class="container">
                <div class="nav-wrapper">
                    <div class="logo">
                        <img src="img/FuturoTecInicial.jpeg" alt="FuturoTEC Logo" />
                    </div>
                    <nav class="nav-desktop company-nav">
                        <a href="InicialEmpresa.html" class="nav-link">Início</a>
                        <a href="MinhasVagas.html" class="nav-link active">Minhas Vagas</a>
                        <a href="CriarVagaEmpresa.html" class="nav-link ">Criar Vaga</a>
                        <a href="EmpresaCandidatos.html" class="nav-link">Candidaturas</a>
                    </nav>
                    <div class="nav-actions">
                        <a href="PerfilEmpresa.html" class="profile-btn">Meu Perfil</a>
                    </div>
                </div>
            </div>
        </header>

        <main class="my-jobs-section">
    <div class="vagas-main-content"> 
        <h2>Minhas Vagas Publicadas</h2>
        <p>Gerencie as vagas que sua empresa criou.</p>
        <div id="vagas-container" class="vagas-grid">
            <p>Carregando vagas...</p>
        </div>
    </div>
</main>

        <div id="edit-modal" class="modal-overlay" style="display: none;">
            <div class="modal-content form-card">
                <form id="edit-job-form">
                    <h2>Editar Vaga</h2>
                    <input type="hidden" id="edit-vaga-id" name="vagaId">
                    <div class="form-group">
                        <label for="edit-titulo">Título da Vaga</label>
                        <input type="text" id="edit-titulo" name="titulo" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-descricao">Descrição da Vaga</label>
                        <textarea id="edit-descricao" name="descricao" rows="5" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="edit-requisitos">Requisitos</label>
                        <textarea id="edit-requisitos" name="requisitos" rows="4" required></textarea>
                    </div>
                    <div class="form-group autocomplete-container">
                        <label for="curso-vaga">Cursos Requeridos (selecione e remova)</label>
                        <div id="cursos-selecionados" class="selected-tags-container"></div>
                        <input type="text" id="curso-vaga" name="curso-nome" placeholder="Busque e adicione cursos">
                        <div id="sugestoes-curso-vaga" class="autocomplete-list"></div>
                    </div>
                    <div class="form-group">
                        <label for="edit-cargaHoraria">Carga Horária</label>
                        <input type="text" id="edit-cargaHoraria" name="cargaHoraria" required>
                    </div>
                    
                    <!-- NOVO CAMPO: Vaga para PCD no modal de edição -->
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="edit-vaga-pcd" name="edit-vaga-pcd">
                            <span class="checkmark"></span>
                            Esta vaga é destinada a Pessoas com Deficiência (PCD)
                        </label>
                    </div>
                    
                    <div class="modal-actions">
                        <button type="submit" class="submit-btn">Salvar Alterações</button>
                        <button type="button" id="cancel-edit-btn" class="cancel-btn">Cancelar</button>
                    </div>
                </form>
            </div>
        </div>

        <footer class="footer">
            <div class="container footer-grid">
                <div class="footer-info">
                    <h4>FuturoTEC</h4>
                    <p>Projeto de Conclusão de Curso (TCC)</p>
                    <p class="school">ETEC Albert Einstein</p>
                    <p class="copyright">© 2025 FuturoTEC. Todos os direitos reservados.</p>
                    <p class="authors">Desenvolvido por: Nátaly Lima, Gustavo Fonseca, Eduarda Marques, Amanda Silva, Gabrielly Mendes, Uillian Oliveira e Felipe Cardoso.</p>
                </div>

                <div class="footer-links">
                    <h4>Links Úteis</h4>
                    <ul>
                        <li><a href="#">Termos de Uso</a></li>
                        <li><a href="#">Política de Privacidade</a></li>
                        <li><a href="#">Sobre nós</a></li>
                        <li><a href="#">Contato</a></li>
                    </ul>
                </div>

                <div class="container">
                    <div class="nav-wrapper">
                        <div class="logo">
                            <img src="img/FuturoTecInicial.jpeg" alt="FuturoTEC Logo" />
                        </div>
                        <br>
                    </div>
                    <h4>Conecte-se</h4>
                    <div class="social-icons">
                        <a href="#"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M4 4v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6H6a2 2 0 0 0-2 2z"></path>
                                <path d="M14 2v6h6"></path>
                                <path d="M8 12h8"></path>
                                <path d="M8 16h8"></path>
                            </svg></a>
                        <a href="#"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path>
                                <rect x="2" y="9" width="4" height="12"></rect>
                                <circle cx="4" cy="4" r="2"></circle>
                            </svg></a>
                        <a href="#"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path>
                            </svg></a>
                    </div>
                </div>
            </div>
        </footer>

    </div>



    <script>
        feather.replace();
    </script>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>



    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyA8Q9cKB4oVmFM6ilHK_70h8JDvgsOQhLY",
            authDomain: "futurotec-e3a69.firebaseapp.com",
            projectId: "futurotec-e3a69",
            storageBucket: "futurotec-e3a69.firebasestorage.app",
            messagingSenderId: "234233783827",
            appId: "1:234233783827:web:bf9376dee78d8924ef01e6",
            measurementId: "G-C7EEMP1146"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();



        const vagasContainer = document.getElementById('vagas-container');

        const editModal = document.getElementById('edit-modal');

        const editForm = document.getElementById('edit-job-form');


        // --- BLOCO DE AUTENTICAÇÃO ---
        firebase.auth().onAuthStateChanged(user => {
            if (user) {
                loadCompanyJobs(user.uid);
            } else {
                window.location.href = 'LoginEmpresa.html';
                vagasContainer.innerHTML = '<p>Você precisa estar logado para ver suas vagas.</p>';
            }
        });
        // --- FIM BLOCO DE AUTENTICAÇÃO ---


        // --- FUNÇÃO: Carrega as vagas filtradas e ordenadas ---
        function loadCompanyJobs(empresaId) {
            // Consulta Corrigida: Filtra pelo ID da empresa e ordena pela data (descendente)
            db.collection('vagas')
                .where('empresaId', '==', empresaId)
                .orderBy('criadaEm', 'desc')
                .get()
                .then(snapshot => {
                    vagasContainer.innerHTML = '';

                    if (snapshot.empty) {
                        vagasContainer.innerHTML = '<p>Você ainda não publicou nenhuma vaga.</p>';
                        return;
                    }

                    snapshot.forEach(doc => {
                        const vaga = doc.data();
                        vaga.id = doc.id;
                        const isFinalizada = vaga.status === 'finalizada';

                        // Adiciona badge PCD se a vaga for para PCD
                        const pcdBadge = vaga.pcd ? '<span class="pcd-badge">Vaga PCD</span>' : '';

                        const div = document.createElement('div');
                        div.className = `vaga-card ${isFinalizada ? 'finalizada' : ''}`;

                        div.innerHTML = `
                            <h3>${vaga.titulo} ${pcdBadge} ${isFinalizada ? '(ENCERRADA)' : ''}</h3>
                            <p>${vaga.descricao}</p>
                            <div class="vaga-actions">
                                <button class="edit-btn" onclick='abrirModalEdicao(${JSON.stringify(vaga).replace(/'/g, "\\'")})' ${isFinalizada ? 'disabled' : ''}>
                                    <i data-feather="edit"></i> Editar
                                </button>
                                
                                ${!isFinalizada ? `
                                    <button class="finish-btn" onclick='finalizarVaga("${vaga.id}")'>
                                        <i data-feather="check-square"></i> Finalizar Vaga
                                    </button>
                                ` : ''}
                                <button class="delete-btn" onclick='excluirVaga("${vaga.id}")'>
                                    <i data-feather="trash-2"></i> Excluir
                                </button>
                            </div>
                        `;

                        vagasContainer.appendChild(div);
                    });

                    feather.replace();
                })
                .catch(error => {
                    console.error("Erro ao carregar vagas da empresa:", error);
                    vagasContainer.innerHTML = '<p style="color: red;">Erro ao carregar vagas. Verifique os logs do console.</p>';
                });
        }
        // --- FIM FUNÇÃO: Carrega as vagas ---


        function excluirVaga(vagaId) {
            if (confirm("Deseja realmente excluir esta vaga? Esta ação é irreversível.")) {
                db.collection('vagas').doc(vagaId).delete()
                    .then(() => window.location.reload())
                    .catch(err => alert("Erro ao excluir: " + err));
            }
        }


        // --- FUNÇÃO: Finalizar Vaga ---
        function finalizarVaga(vagaId) {
            if (confirm("Deseja realmente FINALIZAR esta vaga? Ela será removida da lista de vagas abertas.")) {
                db.collection('vagas').doc(vagaId).update({
                        status: 'finalizada'
                    })
                    .then(() => {
                        alert("Vaga finalizada com sucesso!");
                        window.location.reload();
                    })
                    .catch(err => {
                        console.error("Erro ao finalizar vaga:", err);
                        alert("Erro ao finalizar vaga. Tente novamente.");
                    });
            }
        }
        // --- FIM FUNÇÃO: Finalizar Vaga ---


        function abrirModalEdicao(vaga) {
            editModal.style.display = 'flex';
            editForm['vagaId'].value = vaga.id;
            editForm['titulo'].value = vaga.titulo;
            editForm['descricao'].value = vaga.descricao;
            editForm['requisitos'].value = vaga.requisitos;
            editForm['cargaHoraria'].value = vaga.cargaHoraria || '';
            
            // NOVO: Pré-preenche o checkbox PCD
            const pcdCheckbox = document.getElementById('edit-vaga-pcd');
            if (pcdCheckbox) {
                pcdCheckbox.checked = vaga.pcd || false;
            }
        }

        document.getElementById('cancel-edit-btn').addEventListener('click', () => {
            editModal.style.display = 'none';
        });

        editForm.addEventListener('submit', e => {
            e.preventDefault();
            const vagaId = editForm['vagaId'].value;
            
            // NOVO: Inclui o campo PCD na atualização
            const updateData = {
                titulo: editForm['titulo'].value,
                descricao: editForm['descricao'].value,
                requisitos: editForm['requisitos'].value,
                cargaHoraria: editForm['cargaHoraria'].value,
                pcd: document.getElementById('edit-vaga-pcd').checked
            };
            
            db.collection('vagas').doc(vagaId).update(updateData)
                .then(() => {
                    alert("Vaga atualizada com sucesso!");
                    editModal.style.display = 'none';
                    window.location.reload();
                })
                .catch(err => {
                    console.error(err);
                    alert("Erro ao atualizar vaga.");
                });
        });
    </script>
</body>

</html>
