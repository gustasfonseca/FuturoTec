<!DOCTYPE html>

<html lang="pt-BR">

<head>

  <meta charset="UTF-8">

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Minhas Vagas | FuturoTEC</title>

  <link rel="stylesheet" href="css/styles.css" />

  <link rel="stylesheet" href="css/empresa.css" />

  <script src="https://unpkg.com/feather-icons"></script>



  <style>
    /* Botões dentro do card de vaga */

    .vaga-actions {

      display: flex;

      gap: 10px;

      margin-top: 10px;

    }



    /* Botão Editar */

    .vaga-actions .edit-btn {

      background-color: #008080;

      color: #fff;

      border: none;

      padding: 6px 12px;

      border-radius: 6px;

      cursor: pointer;

      font-size: 14px;

      display: flex;

      align-items: center;

      gap: 5px;

      transition: background-color 0.2s;

    }

    .vaga-actions .edit-btn:hover {

      background-color: #006666;

    }



    /* --- NOVO ESTILO: Botão Finalizar Vaga --- */

    .vaga-actions .finish-btn {

      background-color: #ff9900;
      /* Laranja para destaque */

      color: #fff;

      border: none;

      padding: 6px 12px;

      border-radius: 6px;

      cursor: pointer;

      font-size: 14px;

      display: flex;

      align-items: center;

      gap: 5px;

      transition: background-color 0.2s;

    }

    .vaga-actions .finish-btn:hover {

      background-color: #cc7a00;
      /* Laranja mais escuro no hover */

    }

    /* --- FIM NOVO ESTILO --- */



    /* Botão Excluir */

    .vaga-actions .delete-btn {

      background-color: #ff4d4d;

      color: #fff;

      border: none;

      padding: 6px 12px;

      border-radius: 6px;

      cursor: pointer;

      font-size: 14px;

      display: flex;

      align-items: center;

      gap: 5px;

      transition: background-color 0.2s;

    }

    .vaga-actions .delete-btn:hover {

      background-color: #cc0000;

    }

    /* Estilo para vagas finalizadas (opcional, mas útil) */
    .vaga-card.finalizada {
      opacity: 0.6;
      border-left: 5px solid #ff9900;
    }
  </style>

</head>

<body>

  <div class="app">

    <header class="header">

      <div class="container">

        <div class="nav-wrapper">

          <div class="logo">

            <img src="img/FuturoTecInicial.jpeg" alt="FuturoTEC Logo" />

          </div>

          <nav class="nav-desktop company-nav">

            <a href="InicialEmpresa.html" class="nav-link">Início</a>

            <a href="MinhasVagas.html" class="nav-link active">Minhas Vagas</a>

            <a href="CriarVagaEmpresa.html" class="nav-link ">Criar Vaga</a>

            <a href="EmpresaCandidatos.html" class="nav-link">Candidaturas</a>

          </nav>

          <div class="nav-actions">

            <a href="PerfilEmpresa.html" class="profile-btn">Meu Perfil</a>

          </div>

        </div>

      </div>

    </header>



    <main class="my-jobs-section">

      <div class="container">

        <h2>Minhas Vagas Publicadas</h2>

        <p>Gerencie as vagas que sua empresa criou.</p>

        <div id="vagas-container" class="vagas-grid">

          <p>Carregando vagas...</p>

        </div>

      </div>

    </main>



    <div id="edit-modal" class="modal-overlay" style="display: none;">

      <div class="modal-content form-card">

        <form id="edit-job-form">

          <h2>Editar Vaga</h2>

          <input type="hidden" id="edit-vaga-id" name="vagaId">

          <div class="form-group">

            <label for="edit-titulo">Título da Vaga</label>

            <input type="text" id="edit-titulo" name="titulo" required>

          </div>

          <div class="form-group">

            <label for="edit-descricao">Descrição da Vaga</label>

            <textarea id="edit-descricao" name="descricao" rows="5" required></textarea>

          </div>

          <div class="form-group">

            <label for="edit-requisitos">Requisitos</label>

            <textarea id="edit-requisitos" name="requisitos" rows="4" required></textarea>

          </div>

          <div class="form-group autocomplete-container">

            <label for="curso-vaga">Cursos Requeridos (selecione e remova)</label>

            <div id="cursos-selecionados" class="selected-tags-container"></div>

            <input type="text" id="curso-vaga" name="curso-nome" placeholder="Busque e adicione cursos">

            <div id="sugestoes-curso-vaga" class="autocomplete-list"></div>

          </div>

          <div class="form-group">

            <label for="edit-cargaHoraria">Carga Horária</label>

            <input type="text" id="edit-cargaHoraria" name="cargaHoraria" required>

          </div>

          <div class="modal-actions">

            <button type="submit" class="submit-btn">Salvar Alterações</button>

            <button type="button" id="cancel-edit-btn" class="cancel-btn">Cancelar</button>

          </div>

        </form>

      </div>

    </div>



    <footer class="footer">

      <div class="container footer-grid">

        <div class="footer-info">

          <h4>FuturoTEC</h4>

          <p>Projeto de Conclusão de Curso (TCC)</p>

          <p class="school">ETEC Albert Einstein</p>

          <p class="copyright">©️ 2025 FuturoTEC. Todos os direitos reservados.</p>

          <p class="authors">

            Desenvolvido por: Nátaly Lima, Gustavo Fonseca, Eduarda Marques,

            Amanda Silva, Gabrielly Mendes, Uillian Oliveira e Felipe Cardoso.

          </p>

        </div>

        <div class="footer-links">

          <h4>Links Úteis</h4>

          <ul>

            <li><a href="#">Termos de Uso</a></li>

            <li><a href="#">Política de Privacidade</a></li>

            <li><a href="#">Sobre nós</a></li>

            <li><a href="#">Contato</a></li>

          </ul>

        </div>

      </div>

    </footer>

  </div>



  <script>feather.replace();</script>

  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>

  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>

  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>



  <script>

    const firebaseConfig = {

      apiKey: "AIzaSyA8Q9cKB4oVmFM6ilHK_70h8JDvgsOQhLY",

      authDomain: "futurotec-e3a69.firebaseapp.com",

      projectId: "futurotec-e3a69",

      storageBucket: "futurotec-e3a69.firebasestorage.app",

      messagingSenderId: "234233783827",

      appId: "1:234233783827:web:bf9376dee78d8924ef01e6",

      measurementId: "G-C7EEMP1146"

    };

    firebase.initializeApp(firebaseConfig);

    const db = firebase.firestore();



    const vagasContainer = document.getElementById('vagas-container');

    const editModal = document.getElementById('edit-modal');

    const editForm = document.getElementById('edit-job-form');



    db.collection('vagas').get().then(snapshot => {

      vagasContainer.innerHTML = '';

      snapshot.forEach(doc => {

        const vaga = doc.data();

        vaga.id = doc.id;

        // Adiciona o status para verificar se está finalizada
        const isFinalizada = vaga.status === 'finalizada';


        const div = document.createElement('div');
        // Adiciona a classe 'finalizada' se o status for 'finalizada'
        div.className = `vaga-card ${isFinalizada ? 'finalizada' : ''}`;

        div.innerHTML = `

                    <h3>${vaga.titulo} ${isFinalizada ? '(ENCERRADA)' : ''}</h3>

                    <p>${vaga.descricao}</p>

                    <div class="vaga-actions">

                        <button class="edit-btn" onclick='abrirModalEdicao(${JSON.stringify(vaga)})' ${isFinalizada ? 'disabled' : ''}>

                            <i data-feather="edit"></i> Editar

                        </button>
                        
                        ${!isFinalizada ? `
                            <button class="finish-btn" onclick='finalizarVaga("${vaga.id}")'>
                                <i data-feather="check-square"></i> Finalizar Vaga
                            </button>
                        ` : ''}
                        <button class="delete-btn" onclick='excluirVaga("${vaga.id}")'>

                            <i data-feather="trash-2"></i> Excluir

                        </button>

                    </div>

                `;

        vagasContainer.appendChild(div);

      });

      feather.replace();

    });



    function excluirVaga(vagaId) {

      if (confirm("Deseja realmente excluir esta vaga? Esta ação é irreversível.")) {

        db.collection('vagas').doc(vagaId).delete()

          .then(() => window.location.reload())

          .catch(err => alert("Erro ao excluir: " + err));

      }

    }


    // --- NOVA FUNÇÃO: Finalizar Vaga ---
    function finalizarVaga(vagaId) {
      if (confirm("Deseja realmente FINALIZAR esta vaga? Ela será removida da lista de vagas abertas.")) {
        // Atualiza o documento no Firestore, definindo o campo 'status' como 'finalizada'
        db.collection('vagas').doc(vagaId).update({
          status: 'finalizada'
        })
          .then(() => {
            alert("Vaga finalizada com sucesso!");
            window.location.reload(); // Recarrega para refletir a mudança
          })
          .catch(err => {
            console.error("Erro ao finalizar vaga:", err);
            alert("Erro ao finalizar vaga. Tente novamente.");
          });
      }
    }
    // --- FIM NOVA FUNÇÃO ---


    function abrirModalEdicao(vaga) {

      editModal.style.display = 'flex';

      editForm['vagaId'].value = vaga.id;

      editForm['titulo'].value = vaga.titulo;

      editForm['descricao'].value = vaga.descricao;

      editForm['requisitos'].value = vaga.requisitos;

      editForm['cargaHoraria'].value = vaga.cargaHoraria || '';

    }



    document.getElementById('cancel-edit-btn').addEventListener('click', () => {

      editModal.style.display = 'none';

    });



    editForm.addEventListener('submit', e => {

      e.preventDefault();

      const vagaId = editForm['vagaId'].value;



      db.collection('vagas').doc(vagaId).update({

        titulo: editForm['titulo'].value,

        descricao: editForm['descricao'].value,

        requisitos: editForm['requisitos'].value,

        cargaHoraria: editForm['cargaHoraria'].value

      }).then(() => {

        alert("Vaga atualizada com sucesso!");

        editModal.style.display = 'none';

        window.location.reload();

      }).catch(err => {

        console.error(err);

        alert("Erro ao atualizar vaga.");

      });

    });

  </script>

</body>

</html>>
