<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minhas Candidaturas | FuturoTEC</title>
    <link rel="stylesheet" href="css/alerts.css" />
    <link rel="stylesheet" href="css/styles.css" />
    
    <script src="https://unpkg.com/feather-icons"></script>
</head>
<body>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script>
        // COLE A CONFIGURAÇÃO DO SEU PROJETO FIREBASE AQUI
        const firebaseConfig = {
            apiKey: "AIzaSyA8Q9cKB4oVmFM6ilHK_70h8JDvgsOQhLY",
            authDomain: "futurotec-e3a69.firebaseapp.com",
            projectId: "futurotec-e3a69",
            storageBucket: "futurotec-e3a69.firebasestorage.app",
            messagingSenderId: "234233783827",
            appId: "1:234233783827:web:bf9376dee78d8924ef01e6",
            measurementId: "G-C7EEMP1146"
        };
        firebase.initializeApp(firebaseConfig);
    </script>
    
    <div class="app">
        <header class="header">
            <div class="container">
                <div class="nav-wrapper">
                    <div class="logo">
                        <img src="img/FuturoTecInicial.jpeg" alt="FuturoTEC Logo" />
                    </div>
                    <nav class="nav-desktop student-nav">
                        <a href="InicialAluno.html" class="nav-link">Início</a>
                        <a href="InicialAluno.html#cursos" class="nav-link">Cursos</a>
                        <a href="VagasAluno.html" class="nav-link">Vagas</a>
                        <a href="minhasCandidaturas.html" class="nav-link ">Candidaturas</a>
                    </nav>
                    <div class="nav-actions">
                        <a href="PerfilAluno.html" class="login-btn">Meu Perfil</a>
                        
                    </div>
                </div>
            </div>
        </header>

        <main>
    <div class="content-container-colored">

        <header class="page-header-colored">
            <h2 class="section-title">Acompanhamento de Candidaturas</h2>
            <p class="section-subtitle">Aqui você pode ver o status das vagas que você se candidatou.</p>
        </header>
        
        <div id="candidaturas-container" class="candidaturas-list">
            <p class="info-message">Carregando suas candidaturas...</p>
        </div>
        
    </div>
</main>

        
    <footer class="footer">
    <div class="container footer-grid">
        <div class="footer-info">
            <h4>FuturoTEC</h4>
            <p>Projeto de Conclusão de Curso (TCC)</p>
            <p class="school">ETEC Albert Einstein</p>
            <p class="copyright">© 2025 FuturoTEC. Todos os direitos reservados.</p>
            <p class="authors">Desenvolvido por: Nátaly Lima, Gustavo Fonseca, Eduarda Marques, Amanda Silva, Gabrielly Mendes, Uillian Oliveira e Felipe Cardoso.</p>
        </div>

        <div class="footer-links">
            <h4>Links Úteis</h4>
            <ul>
                <li><a href="#">Termos de Uso</a></li>
                <li><a href="#">Política de Privacidade</a></li>
                <li><a href="#">Sobre nós</a></li>
                <li><a href="#">Contato</a></li>
            </ul>
        </div>

      <div class="container">
            <div class="nav-wrapper">
                <div class="logo">
                    <img src="img/FuturoTecInicial.jpeg" alt="FuturoTEC Logo" />
                </div>
                <br></div>
            <h4>Conecte-se</h4>
            <div class="social-icons">
                <a href="#"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6H6a2 2 0 0 0-2 2z"></path><path d="M14 2v6h6"></path><path d="M8 12h8"></path><path d="M8 16h8"></path></svg></a>
                <a href="#"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg></a>
                <a href="#"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg></a>
            </div>
        </div>
    </div>
    </footer>
    
    <script>
        feather.replace();
    </script>
    <script type="module" src="js/alert-manager.js"></script>
    <script type="module" src="js/aluno.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const candidaturasContainer = document.getElementById('candidaturas-container');
    
            // 1. Verifica o estado de autenticação do usuário
            firebase.auth().onAuthStateChanged(user => {
                if (user) {
                    // Usuário está logado, busca as candidaturas
                    carregarCandidaturas(user.uid);
                } else {
                    // Usuário não está logado
                    candidaturasContainer.innerHTML = `
                        <p class="info-message">Você precisa estar logado para ver suas candidaturas.</p>
                        <a href="login.html" class="login-btn-center">Fazer Login</a>
                    `;
                }
            });
    
            // 2. Função assíncrona para buscar os dados no Firebase
            const carregarCandidaturas = async (alunoId) => {
                try {
                    const db = firebase.firestore();
                    // Busca as candidaturas do aluno logado
                    const candidaturasSnapshot = await db.collection('candidaturas')
                                                         .where('alunoId', '==', alunoId)
                                                         .get();
    
                    if (candidaturasSnapshot.empty) {
                        candidaturasContainer.innerHTML = '<p class="info-message">Você ainda não se candidatou a nenhuma vaga.</p>';
                        return;
                    }
    
                    // Limpa a mensagem "Carregando..."
                    candidaturasContainer.innerHTML = '';
    
                    // 3. Mapeia cada candidatura para buscar os detalhes da vaga
                    const promessasVagas = candidaturasSnapshot.docs.map(doc => {
                        const candidaturaData = doc.data();
                        // Busca o documento da vaga usando o vagaId da candidatura
                        return db.collection('vagas').doc(candidaturaData.vagaId).get().then(vagaDoc => {
                            if (vagaDoc.exists) {
                                return { 
                                    status: candidaturaData.status, 
                                    vaga: vagaDoc.data() 
                                };
                            }
                            return null; // Retorna nulo se a vaga não for encontrada
                        });
                    });
    
                    const resultados = await Promise.all(promessasVagas);
    
                    // 4. Cria o HTML e exibe na tela
                    resultados.forEach(item => {
                        if (item) { // Verifica se o item não é nulo
                            const vaga = item.vaga;
                            const status = item.status;
                            
                            const card = document.createElement('div');
                            // Adicione estilos para .candidatura-card no seu CSS para ficar mais bonito
                            card.style.backgroundColor = '#fff';
                            card.style.border = '1px solid #ddd';
                            card.style.borderRadius = '8px';
                            card.style.padding = '20px';
                            card.style.marginBottom = '20px';
                            card.style.boxShadow = '0 2px 4px rgba(0,0,0,0.1)';
    
                            // Define a cor do status
                            let statusColor = '#333'; // Cor padrão
                            if (status === 'Em análise') statusColor = '#f0ad4e'; // Laranja
                            if (status === 'Aprovado') statusColor = '#5cb85c'; // Verde
                            if (status === 'Recusado') statusColor = '#d9534f'; // Vermelho
    
                            card.innerHTML = `
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                    <h3 style="margin: 0; color: #333;">${vaga.titulo || 'Título não encontrado'}</h3>
                                    <span style="background-color: ${statusColor}; color: white; padding: 5px 10px; border-radius: 15px; font-size: 14px;">${status}</span>
                                </div>
                                <p style="margin: 0; color: #666;">${vaga.empresa || 'Empresa não encontrada'}</p>
                            `;
                            candidaturasContainer.appendChild(card);
                        }
                    });
    
                } catch (error) {
                    console.error("Erro ao buscar candidaturas: ", error);
                    candidaturasContainer.innerHTML = '<p class="info-message" style="color: red;">Ocorreu um erro ao carregar suas candidaturas. Tente novamente mais tarde.</p>';
                }
            };
        });
    </script>
</body>
</html>
